---
title: 通用增删改查开发指南
date: 2025-09-24 16:31:00
permalink: /pages/crud-guide
categories:
  - 使用指南
  - 开发规范
tags:
  - CRUD
  - 代码生成
  - 开发规范
  - 架构设计
article: true
sidebar: true
inCatalogue: true
autoTitle: true
articleUpdate: true
inHomePost: true
description: 详细的通用增删改查功能开发指南，包含目录结构要求、完整示例代码和最佳实践，帮助开发者快速构建标准化的业务模块。
coverImg: /img/crud.png
---

# 通用增删改查开发指南

## 概述

本指南以 SysConfig 配置管理接口为例，详细介绍在 jimuqu-admin 框架中实现标准增删改查功能的完整流程。

## 目录结构要求

```
module-name/
├── domain/               # 存放实体类
│   ├── /                 # 数据库实体类
│   ├── bo/               # 业务对象
│   ├── vo/               # 视图对象
│   └── query/            # 查询条件对象
├── mapper/               # 存放数据库操作接口
├── service/              # 存放业务逻辑接口
│   └── impl/             # 存放业务逻辑实现类
└── controller/           # 存放控制器接口
```

## 实体类设计

### 1. 数据库实体类

```java
package com.jimuqu.system.domain;

import cn.xbatis.core.incrementer.IdentifierGeneratorType;
import cn.xbatis.db.IdAutoType;
import cn.xbatis.db.annotations.*;
import com.jimuqu.common.mybatis.core.entity.BaseEntity;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.ToString;
import lombok.experimental.Accessors;
import lombok.experimental.FieldNameConstants;
import org.dromara.autotable.annotation.AutoColumn;

import java.io.Serial;

/**
 * 参数配置
 * @author chengliang4810
 * @since 2025-05-27
 */
@Data
@NoArgsConstructor
@FieldNameConstants
@Accessors(chain = true)
@ToString(callSuper = true)
@EqualsAndHashCode(callSuper = true)
@Table(value = "sys_config")
public class SysConfig extends BaseEntity {

    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 主键设置方式: 每个实体必须设置主键
     */
    @TableId(value = IdAutoType.GENERATOR, generatorName = IdentifierGeneratorType.DEFAULT)
    @AutoColumn(comment = "参数主键")
    private Long id;

    /**
     * 参数名称 字段不能为空，字符串长度
     */
    @AutoColumn(comment = "参数名称", notNull = true, length = 100)
    private String configName;

    /**
     * 系统内置（Y是 N否），默认值的使用
     */
    @AutoColumn(comment = "系统内置（Y是 N否）", length = 1, defaultValue = "N")
    private String configType;

    /**
     * 备注: 字段类型的指定: 长文本使用 MysqlTypeConstant.TEXT
     */
    @AutoColumn(comment = "备注", type = MysqlTypeConstant.TEXT)
    private String remark;
}
```

### 2. 业务对象 (BO)

```java
package com.jimuqu.system.domain.bo;

import com.jimuqu.common.core.validate.group.AddGroup;
import com.jimuqu.common.core.validate.group.UpdateGroup;
import com.jimuqu.common.mybatis.core.entity.BoBaseEntity;
import com.jimuqu.system.domain.SysConfig;
import io.github.linpeilie.annotations.AutoMapper;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;
import org.noear.solon.validation.annotation.*;

/**
 * 参数配置业务对象 sys_config
 *
 * @author chengliang4810
 * @since 2025-05-27
 */
@Data
@Accessors(chain = true)
@EqualsAndHashCode(callSuper = true)
@AutoMapper(target = SysConfig.class, reverseConvertGenerate = false)
public class SysConfigBo extends BoBaseEntity {

    /**
     * 参数主键
     */
    @NotNull(message = "参数主键不能为空", groups = { UpdateGroup.class })
    private Long id;

    /**
     * 参数名称
     */
    @NotBlank(message = "参数名称不能为空", groups = { AddGroup.class, UpdateGroup.class })
    private String configName;

    /**
     * 参数键名
     */
    @NotBlank(message = "参数键名不能为空", groups = { AddGroup.class, UpdateGroup.class })
    private String configKey;

    /**
     * 参数键值
     */
    @NotBlank(message = "参数键值不能为空", groups = { AddGroup.class, UpdateGroup.class })
    private String configValue;

    /**
     * 系统内置（Y是 N否）
     */
    @NotBlank(message = "系统内置（Y是 N否）不能为空", groups = { AddGroup.class, UpdateGroup.class })
    private String configType;

    /**
     * 备注
     */
    @NotBlank(message = "备注不能为空", groups = { AddGroup.class, UpdateGroup.class })
    private String remark;
}
```

### 3. 查询条件对象 (Query)

```java
package com.jimuqu.system.domain.query;

import cn.xbatis.core.sql.ObjectConditionLifeCycle;
import cn.xbatis.db.annotations.Condition;
import cn.xbatis.db.annotations.ConditionTarget;
import com.jimuqu.system.domain.SysConfig;
import lombok.Data;
import lombok.experimental.FieldNameConstants;

import java.io.Serial;
import java.io.Serializable;

import static cn.xbatis.db.annotations.Condition.Type.*;

/**
 * 参数配置查询条件对象
 * @author chengliang4810
 * @since 2025-05-27
 */
@Data
@FieldNameConstants
@ConditionTarget(SysConfig.class)
public class SysConfigQuery implements Serializable, ObjectConditionLifeCycle {

    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 参数主键
     */
    @Condition(value = EQ)
    private Long id;

    /**
     * 参数名称
     */
    @Condition(value = LIKE)
    private String configName;

    /**
     * 参数键名
     */
    @Condition(value = EQ)
    private String configKey;

    /**
     * 参数键值
     */
    @Condition(value = EQ)
    private String configValue;

    /**
     * 系统内置（Y是 N否）
     */
    @Condition(value = EQ)
    private String configType;

    /**
     * 条件构建前执行
     */
    @Override
    public void beforeBuildCondition() {
        // 可以在这里添加自定义条件处理逻辑
    }
}
```

### 4. 视图对象 (VO)

```java
package com.jimuqu.system.domain.vo;

import cn.xbatis.db.annotations.ResultEntity;
import com.jimuqu.system.domain.SysConfig;
import io.github.linpeilie.annotations.AutoMapper;
import lombok.Data;
import lombok.experimental.Accessors;
import lombok.experimental.FieldNameConstants;

import java.io.Serial;
import java.io.Serializable;

/**
 * 参数配置视图对象
 * @author chengliang4810
 * @since 2025-05-27
 */
@Data
@FieldNameConstants
@Accessors(chain = true)
@ResultEntity(SysConfig.class)
@AutoMapper(target = SysConfig.class)
public class SysConfigVo implements Serializable {
    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 参数主键
     */
    private Long id;

    /**
     * 参数名称
     */
    private String configName;

    /**
     * 参数键名
     */
    private String configKey;

    /**
     * 参数键值
     */
    private String configValue;

    /**
     * 系统内置（Y是 N否）
     */
    private String configType;

    /**
     * 备注
     */
    private String remark;
}
```

## 数据访问层

### Mapper 接口

> **注意**: 不需要创建 mapper 的 xml 文件

```java
package com.jimuqu.system.mapper;

import cn.xbatis.core.sql.executor.chain.QueryChain;
import com.jimuqu.common.mybatis.core.mapper.BaseMapperPlus;
import com.jimuqu.system.domain.SysConfig;
import com.jimuqu.system.domain.vo.SysConfigVo;
import org.apache.ibatis.annotations.Mapper;

/**
 * 参数配置数据层
 * @author chengliang4810
 * @since 2025-05-27
 */
@Mapper
public interface SysConfigMapper extends BaseMapperPlus<SysConfig, SysConfigVo> {

    /**
     * 根据键名获取配置
     */
    default SysConfig getByKey(String key) {
        return QueryChain.of(this)
                .where(where -> where.eq(SysConfig::getConfigKey, key))
                .get();
    }

    /**
     * 根据键名获取配置视图对象
     */
    default SysConfigVo getVoByKey(String key) {
        return QueryChain.of(this)
                .where(where -> where.eq(SysConfig::getConfigKey, key))
                .returnType(SysConfigVo.class)
                .get();
    }
}
```

## 业务逻辑层

### Service 接口

```java
package com.jimuqu.system.service;

import com.jimuqu.common.mybatis.core.Page;
import com.jimuqu.common.mybatis.core.page.PageQuery;
import com.jimuqu.system.domain.bo.SysConfigBo;
import com.jimuqu.system.domain.vo.SysConfigVo;
import com.jimuqu.system.domain.query.SysConfigQuery;

import java.util.Collection;
import java.util.List;

/**
 * 参数配置Service接口
 *
 * @author chengliang4810
 * @since 2025-05-27
 */
public interface SysConfigService {

    /**
     * 根据主键查询参数配置
     *
     * @param id 参数配置主键
     * @return {@link SysConfigVo } 参数配置视图对象
     */
    SysConfigVo queryById(Long id);

    /**
     * 查询参数配置分页列表
     *
     * @param query 查询条件对象
     * @param pageQuery 分页条件
     * @return {@link Page }<{@link SysConfigVo }> 参数配置分页对象
     */
    Page<SysConfigVo> queryPageList(SysConfigQuery query, PageQuery pageQuery);

    /**
     * 查询参数配置列表
     *
     * @param query 查询条件对象
     * @return {@link List }<{@link SysConfigVo }> 参数配置列表
     */
    List<SysConfigVo> queryList(SysConfigQuery query);

    /**
     * 新增参数配置
     *
     * @param bo 参数配置业务对象
     * @return {@link Boolean } 新增是否成功
     */
    Boolean insertByBo(SysConfigBo bo);

    /**
     * 更新参数配置
     *
     * @param bo 参数配置业务对象
     * @return {@link Boolean } 更新是否成功
     */
    Boolean updateByBo(SysConfigBo bo);

    /**
     * 批量删除代码生成模板信息
     *
     * @param ids 参数配置主键列表
     * @return {@link Integer } 删除成功条数
     */
    Integer deleteByIds(Collection<Long> ids);
}
```

### Service 实现类

```java
package com.jimuqu.system.service.impl;

import cn.xbatis.core.sql.executor.chain.QueryChain;
import com.jimuqu.common.core.utils.MapstructUtil;
import com.jimuqu.common.mybatis.core.Page;
import com.jimuqu.common.mybatis.core.page.PageQuery;
import com.jimuqu.system.domain.SysConfig;
import com.jimuqu.system.domain.bo.SysConfigBo;
import com.jimuqu.system.domain.vo.SysConfigVo;
import com.jimuqu.system.domain.query.SysConfigQuery;
import com.jimuqu.system.mapper.SysConfigMapper;
import com.jimuqu.system.service.SysConfigService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.noear.solon.annotation.Component;

import java.util.Collection;
import java.util.List;

/**
 * 参数配置Service业务层处理
 *
 * @author chengliang4810
 * @since 2025-05-27
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class SysConfigServiceImpl implements SysConfigService {

    private final SysConfigMapper sysConfigMapper;

    /**
     * 查询参数配置
     */
    @Override
    public SysConfigVo queryById(Long id) {
        return sysConfigMapper.getVoById(id);
    }

    /**
     * 查询参数配置分页列表
     */
    @Override
    public Page<SysConfigVo> queryPageList(SysConfigQuery query, PageQuery pageQuery) {
        return buildQueryChain(query)
                .returnType(SysConfigVo.class)
                .paging(pageQuery.build());
    }

    /**
     * 查询参数配置列表
     */
    @Override
    public List<SysConfigVo> queryList(SysConfigQuery query) {
        QueryChain<SysConfig> queryChain = buildQueryChain(query);
        return queryChain.returnType(SysConfigVo.class).list();
    }

    /**
     * 构建查询条件
     * @param query 查询对象
     * @return 查询条件对象
     */
    private QueryChain<SysConfig> buildQueryChain(SysConfigQuery query) {
        return QueryChain.of(sysConfigMapper)
                .forSearch(true)
                .where(query);
    }

    /**
     * 新增参数配置
     */
    @Override
    public Boolean insertByBo(SysConfigBo bo) {
        SysConfig sysConfig = MapstructUtil.convert(bo, SysConfig.class);
        boolean flag = sysConfigMapper.save(sysConfig) > 0;
        bo.setId(sysConfig.getId());
        return flag;
    }

    /**
     * 修改参数配置
     */
    @Override
    public Boolean updateByBo(SysConfigBo bo) {
        SysConfig sysConfig = MapstructUtil.convert(bo, SysConfig.class);
        return sysConfigMapper.update(sysConfig) > 0;
    }

    /**
     * 批量删除参数配置
     */
    @Override
    public Integer deleteByIds(Collection<Long> ids) {
        return sysConfigMapper.deleteByIds(ids);
    }
}
```

## 控制器层

### Controller 接口

```java
package com.jimuqu.system.controller;

import cn.dev33.satoken.annotation.SaCheckPermission;
import com.jimuqu.common.core.checker.Assert;
import com.jimuqu.common.core.validate.group.AddGroup;
import com.jimuqu.common.core.validate.group.UpdateGroup;
import com.jimuqu.common.log.annotation.Log;
import com.jimuqu.common.log.enums.BusinessType;
import com.jimuqu.common.mybatis.core.Page;
import com.jimuqu.common.mybatis.core.page.PageQuery;
import com.jimuqu.common.web.core.BaseController;
import com.jimuqu.system.domain.bo.SysConfigBo;
import com.jimuqu.system.domain.vo.SysConfigVo;
import com.jimuqu.system.domain.query.SysConfigQuery;
import com.jimuqu.system.service.SysConfigService;
import lombok.RequiredArgsConstructor;
import org.noear.solon.annotation.Controller;
import org.noear.solon.annotation.Get;
import org.noear.solon.annotation.Mapping;
import org.noear.solon.annotation.Post;
import org.noear.solon.validation.annotation.NoRepeatSubmit;
import org.noear.solon.validation.annotation.NotEmpty;
import org.noear.solon.validation.annotation.NotNull;
import org.noear.solon.validation.annotation.Validated;

import java.util.List;

/**
 * 参数配置 Controller
 *
 * @author chengliang4810
 * @since 2025-05-27
 */
@Post
@Controller
@RequiredArgsConstructor
@Mapping("/system/config")
public class SysConfigController extends BaseController {

    private final SysConfigService sysConfigService;

    /**
     * 查询参数配置列表
     */
    @Get
    @Mapping("/list")
    @SaCheckPermission("system:config:list")
    public Page<SysConfigVo> list(SysConfigQuery query, PageQuery pageQuery) {
        return sysConfigService.queryPageList(query, pageQuery);
    }

    /**
     * 获取参数配置详细信息
     *
     * @param id 参数配置主键
     */
    @Get
    @Mapping("/{id}")
    @SaCheckPermission("system:config:query")
    public SysConfigVo getInfo(@NotNull(message = "参数配置主键不能为空") Long id) {
        return sysConfigService.queryById(id);
    }

    /**
     * 新增参数配置
     */
    @Mapping("/add")
    @NoRepeatSubmit
    @SaCheckPermission("system:config:add")
    @Log(title = "新增参数配置", businessType = BusinessType.ADD)
    public Long add(@Validated(AddGroup.class) SysConfigBo bo) {
        boolean result = sysConfigService.insertByBo(bo);
        Assert.isTrue(result, "新增参数配置失败");
        return bo.getId();
    }

    /**
     * 更新参数配置
     */
    @NoRepeatSubmit
    @Mapping("/update")
    @SaCheckPermission("system:config:update")
    @Log(title = "更新参数配置", businessType = BusinessType.UPDATE)
    public void edit(@Validated(UpdateGroup.class) SysConfigBo bo) {
        boolean result = sysConfigService.updateByBo(bo);
        Assert.isTrue(result, "更新参数配置失败");
    }

    /**
     * 删除参数配置
     */
    @Mapping("/delete/{ids}")
    @SaCheckPermission("system:config:delete")
    @Log(title = "删除参数配置", businessType = BusinessType.DELETE)
    public Integer delete(@NotEmpty(message = "主键不能为空") List<Long> ids) {
        Integer num = sysConfigService.deleteByIds(ids);
        Assert.gtZero(num, "删除参数配置失败");
        return num;
    }
}
```

## 基础类说明

### BaseEntity

```java
package com.jimuqu.common.mybatis.core.entity;

import cn.xbatis.db.annotations.TableField;
import lombok.Data;

import java.io.Serial;
import java.io.Serializable;
import java.util.Date;

/**
 * Entity基类
 *
 * @author chengliang
 * @since 2024/06/13
 */
@Data
public class BaseEntity implements Serializable {
    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 创建部门
     */
    @TableField(defaultValue = "{CURRENT_DEPT_ID}")
    protected Long createDept;

    /**
     * 创建者
     */
    @TableField(defaultValue = "{CURRENT_USER_ID}")
    protected Long createBy;

    /**
     * 创建时间
     */
    @TableField(defaultValue = "{NOW}")
    protected Date createTime;

    /**
     * 更新者
     */
    @TableField(defaultValue = "{CURRENT_USER_ID}", updateDefaultValue = "{CURRENT_USER_ID}")
    protected Long updateBy;

    /**
     * 更新时间
     */
    @TableField(defaultValue = "{NOW}", updateDefaultValue = "{NOW}")
    protected Date updateTime;
}
```

### BoBaseEntity

```java
package com.jimuqu.common.mybatis.core.entity;

import lombok.Data;

import java.io.Serial;
import java.io.Serializable;
import java.util.HashMap;
import java.util.Map;

/**
 * BoEntity基类
 *
 * @author chengliang
 * @date 2025/03/16
 */
@Data
public class BoBaseEntity implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 自由拓展参数
     */
    private Map<String, Object> params = new HashMap<>();
}
```

## 最佳实践

### 1. 命名规范
- **实体类**: 使用 `SysConfig` 格式，表名使用 `sys_config`
- **业务对象**: 使用 `SysConfigBo` 格式
- **视图对象**: 使用 `SysConfigVo` 格式
- **查询对象**: 使用 `SysConfigQuery` 格式

### 2. 验证注解使用
- **新增**: 使用 `AddGroup.class`
- **更新**: 使用 `UpdateGroup.class`
- **必填字段**: 使用 `@NotBlank`、`@NotNull`

### 3. 权限控制
- **查询**: `system:config:list`
- **详情**: `system:config:query`
- **新增**: `system:config:add`
- **修改**: `system:config:update`
- **删除**: `system:config:delete`

### 4. 日志记录
- **业务操作**: 使用 `@Log` 注解记录
- **操作类型**: 指定正确的 `BusinessType`

### 5. 性能优化
- **查询优化**: 使用 `forSearch(true)` 自动处理空值
- **分页查询**: 使用 `PageQuery` 进行分页
- **链式查询**: 使用 `QueryChain` 构建复杂查询

## 注意事项

1. **自动映射**: 使用 `@AutoMapper` 注解自动生成映射关系
2. **条件构建**: 使用 `@Condition` 注解自动构建查询条件
3. **分页处理**: 统一使用 `PageQuery` 和 `Page` 处理分页
4. **异常处理**: 使用 `Assert` 工具类处理业务异常
5. **重复提交**: 使用 `@NoRepeatSubmit` 防止重复提交

---

*该指南基于 jimuqu-admin 项目的标准开发规范，开发时请严格按照此规范执行。*