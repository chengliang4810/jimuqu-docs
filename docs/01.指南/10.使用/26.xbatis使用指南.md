---
title: Xbatis 使用指南
date: 2025-09-24 16:44:00
permalink: /pages/xbatis-guide
categories:
  - 使用指南
  - 数据库
tags:
  - xbatis
  - orm
  - 数据库操作
article: true
sidebar: true
inCatalogue: true
autoTitle: true
articleUpdate: true
inHomePost: true
description: Xbatis 是一个强大的 ORM 框架，提供了简洁的 API 和丰富的功能，支持链式查询、条件构建、批量操作等特性。
coverImg: /img/database.png
---

# Xbatis 使用指南

## 概述

Xbatis 是一个基于 MyBatis 的增强型 ORM 框架，提供了更加简洁和强大的 API，支持链式查询、条件构建、批量操作等特性。

## 核心功能

- **链式查询**: 支持流畅的链式 API 调用
- **条件构建**: 提供强大的条件构建器
- **批量操作**: 支持高效的批量插入、更新、删除
- **自动映射**: 支持实体类与数据库表的自动映射
- **类型安全**: 基于 Lambda 表达式的类型安全查询

## 数据操作

### Save 新增数据

#### Mapper 内置方法

- `save(T)`：实体类保存
- `save(T,boolean)`：实体类保存（boolean 为是否 null 值也保存）
- `save(Model)`：Model 类保存
- `save(Model,boolean)`：Model 类保存（boolean 为是否 null 值也保存）
- `saveOrUpdate(T)`：实体类保存或修改
- `saveOrUpdate(T,boolean)`：实体类保存或修改（boolean 为是否 null 值也保存）
- `saveOrUpdate(Model)`：Model 类保存或修改
- `saveOrUpdate(Model,boolean)`：Model 类保存或修改（boolean 为是否 null 值也保存）
- `save(List<T>)`：多个实体类保存（非批量操作）
- `save(List<T>,boolean)`：多个实体类保存（非批量操作）（boolean 为是否 null 值也保存）
- `saveModel(List<Model>)`：多个 Model 类保存（非批量操作）
- `saveModel(List<Model>,boolean)`：多个 Model 类保存（非批量操作）（boolean 为是否 null 值也保存）
- `saveBatch(List<T>)`：多个实体类保存（批量操作）
- `saveBatch(List<T>,saveFields)`：多个实体类，指定列保存（批量操作）
- `saveModelBatch(List<Model>)`：多个 Model 类保存（批量操作）
- `saveModelBatch(List<Model>,saveFields)`：多个 Model 类，指定列保存（批量操作）

#### 单个对象示例

```java
@Autowired
private SysUserMapper sysUserMapper;

public void save() {
    SysUser sysUser = new SysUser();
    sysUser.setUserName("demo");
    sysUserMapper.save(sysUser);
}
```

#### 批量新增示例

```java
@Autowired
private SysUserMapper sysUserMapper;

public void saveBatch() {
    List<SysUser> sysUserList = new ArrayList<>();
    // sysUserList.add() ...
    sysUserMapper.saveBatch(sysUserList);
}
```

### Update 修改数据

#### Mapper 内置方法

- `update(T)`：实体类修改
- `update(T,boolean)`：实体类修改（boolean 为是否 null 值也修改）
- `update(Model)`：Model 类修改
- `update(Model,boolean)`：Model 类修改（boolean 为是否 null 值也修改）
- `saveOrUpdate(T)`：实体类保存或修改
- `saveOrUpdate(T,boolean)`：实体类保存或修改（boolean 为是否 null 值也修改）
- `saveOrUpdate(Model)`：Model 类保存或修改
- `saveOrUpdate(Model,boolean)`：Model 类保存或修改（boolean 为是否 null 值也修改）
- `update(T,forceUpdateFields)`：实体类修改，可强制某些字段修改（null 值会被替换成数据库里的 NULL）
- `update(Model,forceUpdateFields)`：Model 修改，可强制某些字段修改（null 值会被替换成数据库里的 NULL）
- `update(T,Where)`：根据 where，实体类批量修改
- `update(T,boolean,Where)`：根据 where，实体类批量修改（boolean 为是否 null 值也修改）
- `update(Model,Where)`：根据 where，Model 类批量修改
- `update(Model,boolean,Where)`：根据 where，Model 类批量修改（boolean 为是否 null 值也修改）
- `update(List<T>)`：多个实体类修改
- `update(List<T>,boolean)`：多个实体类修改（boolean 为是否 null 值也修改）
- `updateModel(List<Model>)`：多个 Model 类修改
- `updateModel(List<Model>,boolean)`：多个 Model 类修改（boolean 为是否 null 值也修改）
- `update(List<T>,forceUpdateFields)`：多个实体类修改，可强制某些字段修改（null 值会被替换成数据库里的 NULL）

#### 单个对象根据主键修改示例

```java
@Autowired
private SysUserMapper sysUserMapper;

public void update() {
    SysUser sysUser = new SysUser();
    sysUser.setId(1);
    sysUser.setUserName("demo");
    sysUserMapper.update(sysUser);
}
```

#### 基于 where 条件批量修改

```java
@Autowired
private SysUserMapper sysUserMapper;

public void update() {
    SysUser sysUser = new SysUser();
    sysUser.setUserName("where UPDATE");
    sysUserMapper.update(sysUser, where -> {
        where.gt(SysUser::getId, 100);
    });
}
```

#### 列自增操作

```java
@Autowired
private SysUserMapper sysUserMapper;

public void update() {
    UpdateChain.of(sysUserMapper)
            .set(SysUser::getVersion, c -> c.plus(1))
            .eq(SysUser::getId, 1)
            .execute();
}
```

#### 基于 UpdateChain 链式更新

```java
@Autowired
private SysUserMapper sysUserMapper;

public void update() {
    UpdateChain.of(sysUserMapper)
            .update(SysUser.class)
            .set(SysUser::getUserName, "new userName")
            .eq(SysUser::getId, 1)
            .execute();
}
```

### Delete 删除数据

#### Mapper 内置方法

- `deleteAll()`：删除所有
- `deleteById(id)`：根据 ID 删除
- `deleteById(ids)`：多个 ID 删除
- `delete(T)`：一个实体类删除
- `delete(List<T>)`：多个实体类删除
- `delete(Where)`：动态条件删除

#### 根据 ID 删除

```java
@Autowired
private SysUserMapper sysUserMapper;

public void delete() {
    sysUserMapper.deleteById(1);
}
```

#### 根据实体类删除

```java
@Autowired
private SysUserMapper sysUserMapper;

public void delete() {
    SysUserModel sysUser = sysUserMapper.getById(1);
    sysUserMapper.delete(sysUser);
}
```

#### 基于 DeleteChain 链式删除

```java
@Autowired
private SysUserMapper sysUserMapper;

public void delete() {
    DeleteChain.of(sysUserMapper)
            .eq(SysUser::getId, 1)
            .execute();
}
```

#### 基于 where 条件批量删除

```java
@Autowired
private SysUserMapper sysUserMapper;

public void delete() {
    sysUserMapper.delete(where -> {
        where.gt(SysUser::getId, 100);
    });
}
```

### Query 查询数据

#### Mapper 内置方法

- `getById(id)`：根据 ID 查询
- `getById(id,selectFields)`：根据 ID 查询，可选择部分列
- `get(Where)`：动态条件，单个查询

#### ID 查询

```java
public class Demo {
    @Autowired
    private SysUserMapper sysUserMapper;

    public void getById() {
        SysUser sysUser = sysUserMapper.getById(1);
    }
}
```

#### 根据 ID 查询，可选择部分列

```java
public class Demo {
    @Autowired
    private SysUserMapper sysUserMapper;

    public void getById() {
        SysUser sysUser = sysUserMapper.getById(1, SysUser::getId, SysUser::getUserName);
    }
}
```

#### 动态 where 查询

```java
public class Demo {
    @Autowired
    private SysUserMapper sysUserMapper;

    public void getById() {
        SysUser sysUser = sysUserMapper.get(where -> {
            where.eq(SysUser::getId, 1);
        });
    }
}
```

#### 链路查询

```java
SysUserRoleVo sysUserRoleVo = QueryChain.of(sysUserMapper)
    .select(SysUser.class, SysRole.class)
    .from(SysUser.class)
    .join(SysUser.class, SysRole.class, on -> on.eq(SysUser::getRole_id, SysRole::getId))
    .eq(SysUser::getId, 1)
    .like(SysUser::getUserName, "abc")
    .groupBy(SysUser::getId)
    .having(SysUser::getId, c -> c.count().gt(0))
    .orderBy(SysUser::getId)
    .returnType(SysUserRoleVo.class)
    .get();
```

#### 搜索条件优化

```java
// 忽略 null 值，忽略空字符串，自动对字符串 trim 操作
SysUser sysUser = QueryChain.of(sysUserMapper)
    .forSearch(true);
```

```java
SysUser sysUser = QueryChain.of(sysUserMapper)
    // 忽略 null 条件参数
    .ignoreNullValueInCondition(true)
    // 忽略空字符串条件参数
    .ignoreEmptyInCondition(true)
    // 对字符串进行 trim 去空格操作
    .trimStringInCondition(true);
```

## 最佳实践

### 1. 条件构建优化

- 使用 `forSearch(true)` 自动处理 null 值和空字符串
- 使用 Lambda 表达式确保类型安全
- 合理使用链式查询提高代码可读性

### 2. 批量操作建议

- 大批量数据使用 `saveBatch` 等批量操作方法
- 注意批量操作的事务管理
- 合理设置批量大小避免内存溢出

### 3. 性能优化

- 使用 `selectFields` 只查询需要的字段
- 合理使用索引和条件构建
- 避免在循环中执行数据库操作

### 4. 错误处理

- 建议添加适当的异常处理
- 注意数据库连接和资源管理
- 合理使用日志记录

## 注意事项

1. **类型安全**: 推荐使用 Lambda 表达式构建条件，避免字符串拼接
2. **批量操作**: 大批量数据操作时注意内存和事务管理
3. **性能考虑**: 复杂查询时注意索引使用和 SQL 优化
4. **异常处理**: 建议添加适当的异常处理和日志记录

---

*本文档基于 Xbatis 框架的实际使用经验整理，如有更新请参考官方文档。*